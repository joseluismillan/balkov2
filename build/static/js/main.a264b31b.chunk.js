(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[0],{113:function(e,t){},213:function(e){e.exports=JSON.parse('{"mapboxApiAccessToken":"pk.eyJ1Ijoiam9zZWx1aXNtaWxsYW4iLCJhIjoiY2tpNmdvZzk0Mmg5YzMzbzNndWt1a2FseiJ9.2MKOcxoAMiOb6t2b9wwAlw"}')},741:function(e,t,n){"use strict";n.r(t);var a,s=n(9),r=n(0),o=n(71),c=n.n(o),i=n(774),l=n(773),u=n(47),d={aws_project_region:"us-east-1",aws_cognito_identity_pool_id:"us-east-1:e7c0eb35-948e-4c93-a996-04816ab8d7c7",aws_cognito_region:"us-east-1",aws_user_pools_id:"us-east-1_ShGCiUstB",aws_user_pools_web_client_id:"7rso807hvs9ju6cp1n2i776m7h",oauth:{},aws_appsync_graphqlEndpoint:"https://r3mb5ljur5eqnkyho34cns6oey.appsync-api.us-east-1.amazonaws.com/graphql",aws_appsync_region:"us-east-1",aws_appsync_authenticationType:"AMAZON_COGNITO_USER_POOLS"},b=n(209),j=n.n(b),p=n(216),O=Object(p.a)({palette:{type:"dark",primary:{main:"#232F3E"},secondary:{main:"#ffffff"},error:{main:j.a.A400}}}),f=n(81),m=n(27),h=n(215),x=n(775),g=n(766),v=n(767),S=n(776),y=n(768),w=n(769),k=Object(g.a)((function(e){return{title:{flexGrow:1},toolbarButtons:{marginLeft:"auto"}}})),C=function(){var e=Object(m.h)(),t=k(),n=Object(m.g)();return Object(s.jsx)(v.a,{position:"fixed",children:Object(s.jsxs)(y.a,{children:[Object(s.jsx)(w.a,{variant:"h6",className:t.title,children:"Red IOT Balko"}),Object(s.jsx)("div",{className:t.toolbarButtons,children:Object(s.jsx)(S.a,{color:"inherit",onClick:function(){"/"!==e.pathname&&n.push("/")},children:"Map"})})]})})},N=Object(g.a)((function(e){return{appBody:{minHeight:"600px"}}})),_=function(e){var t=N();return Object(s.jsxs)(x.a,{my:4,children:[Object(s.jsx)(C,{}),Object(s.jsx)("div",{className:t.appBody,children:e.children})]})},A=n(62),I=n(210),E=n(217),R=n(41),T=n.n(R),V=n(60),z=n(40),M=(n(182),n(87)),q=n(212),B=n.n(q),U=function(e){return Object(s.jsx)(M.a,{longitude:e.longitude,latitude:e.latitude,children:Object(s.jsx)(B.a,{fontSize:"small",style:{color:e.color},onClick:function(){return e.onSensorClick(e.id)}})},e.id)},F=function(){var e=Object(V.a)(T.a.mark((function e(t){var n,a;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.graphql(Object(u.c)("\n  query GetSensor($sensorId: String!) {\n    getSensor(sensorId: $sensorId) {\n      sensorId\n      name\n      enabled\n      geo {\n        latitude\n        longitude\n      }\n      status\n    }\n  }\n",{sensorId:t}));case 3:if(!(n=e.sent).data.getSensor){e.next=9;break}return a=n.data.getSensor,e.abrupt("return",a);case 9:return e.abrupt("return",null);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),G=function(){var e=Object(V.a)(T.a.mark((function e(){var t,n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.graphql(Object(u.c)("\n  query ListSensors {\n    listSensors {\n      sensorId\n      name\n      enabled\n      geo {\n        latitude\n        longitude\n      }\n      status\n    }\n  }\n"));case 3:if(!(t=e.sent).data||!t.data.listSensors){e.next=9;break}return n=t.data.listSensors,e.abrupt("return",n);case 9:return e.abrupt("return",Array());case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),H=n(213),L=Object(g.a)((function(){return{navStyle:{position:"absolute",top:36,left:0,padding:"10px"}}})),W=function(){var e=Object(m.g)(),t=L(),n=Object(r.useState)({latitude:-44.2074,longitude:-73.8547,zoom:7,bearing:0,pitch:0}),a=Object(z.a)(n,2),o=a[0],c=a[1],i=Object(r.useState)([]),l=Object(z.a)(i,2),d=l[0],b=l[1],j=Object(r.useState)(!1),p=Object(z.a)(j,2),O=p[0],f=p[1];Object(r.useEffect)((function(){(function(){var e=Object(V.a)(T.a.mark((function e(){var t;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching sensors"),e.prev=1,e.next=4,G();case 4:(t=e.sent)&&(b(t),console.log("sensors retrived"),f(!0)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error fetching sensors",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(r.useEffect)((function(){if(O){console.log("start subscription to sensors");var e=u.a.graphql(Object(u.c)("\n  subscription OnCreateSensorValues {\n    onCreateSensorValues {\n      id\n      sensorId\n      pH\n      temperature\n      salinity\n      disolvedO2\n      status\n      timestamp\n      createdAt\n      updatedAt\n    }\n  }\n")).subscribe({next:function(e){if(e.value.data.onCreateSensorValues){var t,n=Object(E.a)(d),a=Object(I.a)(n);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(s.sensorId===e.value.data.onCreateSensorValues.sensorId){s.status=e.value.data.onCreateSensorValues.status;break}}}catch(r){a.e(r)}finally{a.f()}console.log("sensors updated"),b(n)}},error:function(e){console.log("error on sensors subscription",e)}});return function(){console.log("terminating subscription to sensors"),e.unsubscribe()}}}),[O]);var h=function(t){e.push("/sensor/"+t)};return Object(s.jsx)("div",{children:Object(s.jsxs)(M.c,Object(A.a)(Object(A.a)({},o),{},{width:"100vw",height:"100vh",mapStyle:"mapbox://styles/mapbox/dark-v9",onViewportChange:function(e){e.zoom>=7&&c(e)},mapboxApiAccessToken:H.mapboxApiAccessToken,children:[d.map((function(e){return Object(s.jsx)(U,{id:e.sensorId,latitude:e.geo.latitude,longitude:e.geo.longitude,color:(t=e.status,1===t?"green":2===t?"yellow":3===t?"red":"white"),onSensorClick:h},e.sensorId);var t})),Object(s.jsx)("div",{className:t.navStyle,children:Object(s.jsx)(M.b,{})})]}))})},D=n(771),J=n(772),$=n(746),X=n(770),P=Object(g.a)((function(e){return{paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column",height:175},title:{fontSize:20},value:{fontSize:75,marginTop:10,marginLeft:"auto",marginRight:"auto"}}}));!function(e){e[e.CURRENT=0]="CURRENT",e[e.AVG=1]="AVG",e[e.MIN=2]="MIN",e[e.MAX=3]="MAX"}(a||(a={}));var Y=function(e){var t=e.mode,n=e.title,o=e.value,c=P(),i=Object(r.useState)({count:0,total:0,current:0,avg:0,min:0,max:0}),l=Object(z.a)(i,2),u=l[0],d=l[1];return Object(r.useEffect)((function(){o&&function(e){var t=Object(A.a)({},u);t.current=e,t.count=t.count+1,t.total=t.total+e,t.avg=parseFloat((t.total/t.count).toFixed(1)),e>t.max&&(t.max=e),(0===t.min||e<t.min)&&(t.min=e),d(t)}(o)}),[o]),Object(s.jsxs)($.a,{className:c.paper,children:[Object(s.jsx)("div",{className:c.title,children:n}),Object(s.jsxs)("div",{className:c.value,children:[!o&&Object(s.jsx)(X.a,{color:"secondary"}),o&&t===a.AVG&&u.avg,o&&t===a.CURRENT&&u.current,o&&t===a.MIN&&u.min,o&&t===a.MAX&&u.max]})]})},Z=n(214);n(130).defaults.global.defaultFontColor="#ffffff";var K=Object(g.a)((function(e){return{paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},title:{fontSize:20},chart:{padding:10,height:400}}})),Q=function(e){var t=e.title,n=e.value,a=K(),o=Object(r.useState)({labels:[],datasets:[{pointBackgroundColor:"#fff",data:[]}]}),c=Object(z.a)(o,2),i=c[0],l=c[1];Object(r.useEffect)((function(){n&&function(e){var t=Object(A.a)({},i.datasets[0]);t.data.push(e);var n=Object(A.a)(Object(A.a)({},i),{},{datasets:[t],labels:i.labels.concat((new Date).toLocaleTimeString())});l(n)}(n)}),[n]);return Object(s.jsxs)($.a,{className:a.paper,children:[Object(s.jsx)("div",{className:a.title,children:t}),Object(s.jsx)("div",{className:a.chart,children:Object(s.jsx)(Z.Line,{data:i,options:{title:{display:!1},legend:{display:!1},responsive:!0,maintainAspectRatio:!1}})})]})},ee=Object(g.a)((function(){return{dashboardContainer:{marginTop:100},title:{marginBottom:20,minHeight:30}}})),te=function(){var e=ee(),t=Object(m.i)().id,n=Object(r.useState)("Fetching sensor data..."),o=Object(z.a)(n,2),c=o[0],i=o[1],l=Object(r.useState)(null),d=Object(z.a)(l,2),b=d[0],j=d[1],p=Object(r.useState)(null),O=Object(z.a)(p,2),f=O[0],h=O[1],x=Object(r.useState)(null),g=Object(z.a)(x,2),v=g[0],S=g[1],y=Object(r.useState)(null),k=Object(z.a)(y,2),C=k[0],N=k[1],_=Object(r.useState)(!1),A=Object(z.a)(_,2),I=A[0],E=A[1];return Object(r.useEffect)((function(){E(!1),function(){var e=Object(V.a)(T.a.mark((function e(){var n;return T.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching sensor"),e.prev=1,e.next=4,F(t||"");case 4:(n=e.sent)&&(i(n.name),console.log("sensor retrived"),E(!0)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error fetching sensor",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(r.useEffect)((function(){if(I){console.log("start subscription to sensor");var e=u.a.graphql(Object(u.c)("\n  subscription OnCreateSensorValue($sensorId: String!) {\n    onCreateSensorValue(sensorId: $sensorId) {\n      id\n      sensorId\n      pH\n      temperature\n      salinity\n      disolvedO2\n      status\n      timestamp\n      createdAt\n      updatedAt\n    }\n  }\n",{sensorId:t})).subscribe({next:function(e){e.value.data.onCreateSensorValue&&(j(e.value.data.onCreateSensorValue.pH),h(e.value.data.onCreateSensorValue.temperature),S(e.value.data.onCreateSensorValue.salinity),N(e.value.data.onCreateSensorValue.disolvedO2),console.log("sensor value received"))},error:function(e){console.log("error on sensor subscription",e)}});return function(){console.log("terminating subscription to sensor"),e.unsubscribe()}}}),[t,I]),Object(s.jsxs)(D.a,{className:e.dashboardContainer,maxWidth:"lg",children:[Object(s.jsx)("div",{className:e.title,children:Object(s.jsx)(w.a,{variant:"h5",align:"left",children:c})}),Object(s.jsxs)(J.a,{container:!0,spacing:4,children:[Object(s.jsx)(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3,children:Object(s.jsx)(Y,{mode:a.CURRENT,title:"pH",value:b})}),Object(s.jsx)(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3,children:Object(s.jsx)(Y,{mode:a.CURRENT,title:"Temperature",value:f})}),Object(s.jsx)(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3,children:Object(s.jsx)(Y,{mode:a.CURRENT,title:"Salinity",value:v})}),Object(s.jsx)(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3,children:Object(s.jsx)(Y,{mode:a.CURRENT,title:"Disolved O2",value:C})})]}),Object(s.jsx)(J.a,{container:!0,spacing:4,children:Object(s.jsx)(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:Object(s.jsx)(Q,{title:"pH",value:b})})}),Object(s.jsx)(J.a,{container:!0,spacing:4,children:Object(s.jsx)(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:Object(s.jsx)(Q,{title:"Temperature",value:f})})}),Object(s.jsx)(J.a,{container:!0,spacing:4,children:Object(s.jsx)(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:Object(s.jsx)(Q,{title:"Salinity",value:v})})}),Object(s.jsx)(J.a,{container:!0,spacing:4,children:Object(s.jsx)(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12,children:Object(s.jsx)(Q,{title:"Disolved O2",value:C})})})]})},ne=Object(h.a)((function(){return Object(s.jsx)(f.a,{children:Object(s.jsx)(_,{children:Object(s.jsxs)(m.d,{children:[Object(s.jsx)(m.b,{exact:!0,path:"/",component:W}),Object(s.jsx)(m.b,{exact:!0,path:"/sensor/:id",component:te}),Object(s.jsx)(m.a,{to:"/"})]})})})}),!1,[],null,null,{hideAllDefaults:!0,signUpFields:[{label:"Email",key:"username",required:!0,placeholder:"Email",type:"email",displayOrder:1},{label:"Password",key:"password",required:!0,placeholder:"Password",type:"password",displayOrder:2}]});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.b.configure(d),c.a.render(Object(s.jsxs)(l.a,{theme:O,children:[Object(s.jsx)(i.a,{}),Object(s.jsx)(ne,{})]}),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[741,1,2]]]);
//# sourceMappingURL=main.a264b31b.chunk.js.map
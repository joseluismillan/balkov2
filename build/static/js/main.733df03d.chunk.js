(this.webpackJsonpdashboard=this.webpackJsonpdashboard||[]).push([[0],{110:function(e,t){},210:function(e){e.exports=JSON.parse('{"mapboxApiAccessToken":"pk.eyJ1Ijoiam9zZWx1aXNtaWxsYW4iLCJhIjoiY2tpNmdvZzk0Mmg5YzMzbzNndWt1a2FseiJ9.2MKOcxoAMiOb6t2b9wwAlw"}')},730:function(e,t,a){"use strict";a.r(t);var n,r=a(0),s=a.n(r),o=a(69),c=a.n(o),l=a(763),i=a(762),u=a(45),m={aws_project_region:"us-east-1",aws_cognito_identity_pool_id:"us-east-1:e7c0eb35-948e-4c93-a996-04816ab8d7c7",aws_cognito_region:"us-east-1",aws_user_pools_id:"us-east-1_ShGCiUstB",aws_user_pools_web_client_id:"7rso807hvs9ju6cp1n2i776m7h",oauth:{},aws_appsync_graphqlEndpoint:"https://r3mb5ljur5eqnkyho34cns6oey.appsync-api.us-east-1.amazonaws.com/graphql",aws_appsync_region:"us-east-1",aws_appsync_authenticationType:"AMAZON_COGNITO_USER_POOLS"},d=a(206),p=a.n(d),f=a(214),b=Object(f.a)({palette:{type:"dark",primary:{main:"#232F3E"},secondary:{main:"#ffffff"},error:{main:p.a.A400}}}),g=a(80),v=a(25),h=a(213),E=a(764),O=a(755),j=a(756),x=a(765),y=a(757),S=a(758),w=Object(O.a)((function(e){return{title:{flexGrow:1},toolbarButtons:{marginLeft:"auto"}}})),k=function(){var e=Object(v.h)(),t=w(),a=Object(v.g)();return s.a.createElement(j.a,{position:"fixed"},s.a.createElement(y.a,null,s.a.createElement(S.a,{variant:"h6",className:t.title},"Red IOT Balko"),s.a.createElement("div",{className:t.toolbarButtons},s.a.createElement(x.a,{color:"inherit",onClick:function(){"/"!==e.pathname&&a.push("/")}},"Map"))))},C=Object(O.a)((function(e){return{appBody:{minHeight:"600px"}}})),N=function(e){var t=C();return s.a.createElement(E.a,{my:4},s.a.createElement(k,null),s.a.createElement("div",{className:t.appBody},e.children))},_=a(207),A=a(215),I=a(39),R=a.n(I),T=a(58),V=a(38),z=(a(178),a(85)),M=a(209),q=a.n(M),B=function(e){return s.a.createElement(z.a,{key:e.id,longitude:e.longitude,latitude:e.latitude},s.a.createElement(q.a,{fontSize:"small",style:{color:e.color},onClick:function(){return e.onSensorClick(e.id)}}))},U=function(){var e=Object(T.a)(R.a.mark((function e(t){var a,n;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.graphql(Object(u.c)("\n  query GetSensor($sensorId: String!) {\n    getSensor(sensorId: $sensorId) {\n      sensorId\n      name\n      enabled\n      geo {\n        latitude\n        longitude\n      }\n      status\n    }\n  }\n",{sensorId:t}));case 3:if(!(a=e.sent).data.getSensor){e.next=9;break}return n=a.data.getSensor,e.abrupt("return",n);case 9:return e.abrupt("return",null);case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=Object(T.a)(R.a.mark((function e(){var t,a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,u.a.graphql(Object(u.c)("\n  query ListSensors {\n    listSensors {\n      sensorId\n      name\n      enabled\n      geo {\n        latitude\n        longitude\n      }\n      status\n    }\n  }\n"));case 3:if(!(t=e.sent).data||!t.data.listSensors){e.next=9;break}return a=t.data.listSensors,e.abrupt("return",a);case 9:return e.abrupt("return",Array());case 10:e.next=15;break;case 12:throw e.prev=12,e.t0=e.catch(0),e.t0;case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(){return e.apply(this,arguments)}}(),G=a(210),H=Object(O.a)((function(){return{navStyle:{position:"absolute",top:36,left:0,padding:"10px"}}})),W=function(){var e=Object(v.g)(),t=H(),a=Object(r.useState)({latitude:-44.2074,longitude:-73.8547,zoom:7,bearing:0,pitch:0}),n=Object(V.a)(a,2),o=n[0],c=n[1],l=Object(r.useState)([]),i=Object(V.a)(l,2),m=i[0],d=i[1],p=Object(r.useState)(!1),f=Object(V.a)(p,2),b=f[0],g=f[1];Object(r.useEffect)((function(){(function(){var e=Object(T.a)(R.a.mark((function e(){var t;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching sensors"),e.prev=1,e.next=4,F();case 4:(t=e.sent)&&(d(t),console.log("sensors retrived"),g(!0)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error fetching sensors",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}})()()}),[]),Object(r.useEffect)((function(){if(b){console.log("start subscription to sensors");var e=u.a.graphql(Object(u.c)("\n  subscription OnCreateSensorValues {\n    onCreateSensorValues {\n      id\n      sensorId\n      pH\n      temperature\n      salinity\n      disolvedO2\n      status\n      timestamp\n      createdAt\n      updatedAt\n    }\n  }\n")).subscribe({next:function(e){if(e.value.data.onCreateSensorValues){var t,a=Object(A.a)(m),n=Object(_.a)(a);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.sensorId===e.value.data.onCreateSensorValues.sensorId){r.status=e.value.data.onCreateSensorValues.status;break}}}catch(s){n.e(s)}finally{n.f()}console.log("sensors updated"),d(a)}},error:function(e){console.log("error on sensors subscription",e)}});return function(){console.log("terminating subscription to sensors"),e.unsubscribe()}}}),[b]);var h=function(t){e.push("/sensor/"+t)};return s.a.createElement("div",null,s.a.createElement(z.c,Object.assign({},o,{width:"100vw",height:"100vh",mapStyle:"mapbox://styles/mapbox/dark-v9",onViewportChange:function(e){e.zoom>=7&&c(e)},mapboxApiAccessToken:G.mapboxApiAccessToken}),m.map((function(e){return s.a.createElement(B,{key:e.sensorId,id:e.sensorId,latitude:e.geo.latitude,longitude:e.geo.longitude,color:(t=e.status,1===t?"green":2===t?"yellow":3===t?"red":"white"),onSensorClick:h});var t})),s.a.createElement("div",{className:t.navStyle},s.a.createElement(z.b,null))))},D=a(760),J=a(761),L=a(74),$=a(735),X=a(759),P=Object(O.a)((function(e){return{paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column",height:175},title:{fontSize:20},value:{fontSize:75,marginTop:10,marginLeft:"auto",marginRight:"auto"}}}));!function(e){e[e.CURRENT=0]="CURRENT",e[e.AVG=1]="AVG",e[e.MIN=2]="MIN",e[e.MAX=3]="MAX"}(n||(n={}));var Y=function(e){var t=e.mode,a=e.title,o=e.value,c=P(),l=Object(r.useState)({count:0,total:0,current:0,avg:0,min:0,max:0}),i=Object(V.a)(l,2),u=i[0],m=i[1];return Object(r.useEffect)((function(){o&&function(e){var t=Object(L.a)({},u);t.current=e,t.count=t.count+1,t.total=t.total+e,t.avg=parseFloat((t.total/t.count).toFixed(1)),e>t.max&&(t.max=e),(0===t.min||e<t.min)&&(t.min=e),m(t)}(o)}),[o]),s.a.createElement($.a,{className:c.paper},s.a.createElement("div",{className:c.title},a),s.a.createElement("div",{className:c.value},!o&&s.a.createElement(X.a,{color:"secondary"}),o&&t===n.AVG&&u.avg,o&&t===n.CURRENT&&u.current,o&&t===n.MIN&&u.min,o&&t===n.MAX&&u.max))},Z=a(211);a(63).defaults.global.defaultFontColor="#ffffff";var K=Object(O.a)((function(e){return{paper:{padding:e.spacing(2),display:"flex",overflow:"auto",flexDirection:"column"},title:{fontSize:20},chart:{padding:10,height:400}}})),Q=function(e){var t=e.title,a=e.value,n=K(),o=Object(r.useState)({labels:[],datasets:[{pointBackgroundColor:"#fff",data:[]}]}),c=Object(V.a)(o,2),l=c[0],i=c[1];Object(r.useEffect)((function(){a&&function(e){var t=Object(L.a)({},l.datasets[0]);t.data.push(e);var a=Object(L.a)(Object(L.a)({},l),{},{datasets:[t],labels:l.labels.concat((new Date).toLocaleTimeString())});i(a)}(a)}),[a]);return s.a.createElement($.a,{className:n.paper},s.a.createElement("div",{className:n.title},t),s.a.createElement("div",{className:n.chart},s.a.createElement(Z.a,{data:l,options:{title:{display:!1},legend:{display:!1},responsive:!0,maintainAspectRatio:!1}})))},ee=Object(O.a)((function(){return{dashboardContainer:{marginTop:100},title:{marginBottom:20,minHeight:30}}})),te=function(){var e=ee(),t=Object(v.i)().id,a=Object(r.useState)("Fetching sensor data..."),o=Object(V.a)(a,2),c=o[0],l=o[1],i=Object(r.useState)(null),m=Object(V.a)(i,2),d=m[0],p=m[1],f=Object(r.useState)(null),b=Object(V.a)(f,2),g=b[0],h=b[1],E=Object(r.useState)(null),O=Object(V.a)(E,2),j=O[0],x=O[1],y=Object(r.useState)(null),w=Object(V.a)(y,2),k=w[0],C=w[1],N=Object(r.useState)(!1),_=Object(V.a)(N,2),A=_[0],I=_[1];return Object(r.useEffect)((function(){I(!1),function(){var e=Object(T.a)(R.a.mark((function e(){var a;return R.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("fetching sensor"),e.prev=1,e.next=4,U(t||"");case 4:(a=e.sent)&&(l(a.name),console.log("sensor retrived"),I(!0)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.log("error fetching sensor",e.t0);case 11:case"end":return e.stop()}}),e,null,[[1,8]])})));return function(){return e.apply(this,arguments)}}()()}),[t]),Object(r.useEffect)((function(){if(A){console.log("start subscription to sensor");var e=u.a.graphql(Object(u.c)("\n  subscription OnCreateSensorValue($sensorId: String!) {\n    onCreateSensorValue(sensorId: $sensorId) {\n      id\n      sensorId\n      pH\n      temperature\n      salinity\n      disolvedO2\n      status\n      timestamp\n      createdAt\n      updatedAt\n    }\n  }\n",{sensorId:t})).subscribe({next:function(e){e.value.data.onCreateSensorValue&&(p(e.value.data.onCreateSensorValue.pH),h(e.value.data.onCreateSensorValue.temperature),x(e.value.data.onCreateSensorValue.salinity),C(e.value.data.onCreateSensorValue.disolvedO2),console.log("sensor value received"))},error:function(e){console.log("error on sensor subscription",e)}});return function(){console.log("terminating subscription to sensor"),e.unsubscribe()}}}),[t,A]),s.a.createElement(D.a,{className:e.dashboardContainer,maxWidth:"lg"},s.a.createElement("div",{className:e.title},s.a.createElement(S.a,{variant:"h5",align:"left"},c)),s.a.createElement(J.a,{container:!0,spacing:4},s.a.createElement(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3},s.a.createElement(Y,{mode:n.CURRENT,title:"pH",value:d})),s.a.createElement(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3},s.a.createElement(Y,{mode:n.CURRENT,title:"Temperature",value:g})),s.a.createElement(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3},s.a.createElement(Y,{mode:n.CURRENT,title:"Salinity",value:j})),s.a.createElement(J.a,{item:!0,xs:12,sm:6,md:3,lg:3,xl:3},s.a.createElement(Y,{mode:n.CURRENT,title:"Disolved O2",value:k}))),s.a.createElement(J.a,{container:!0,spacing:4},s.a.createElement(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12},s.a.createElement(Q,{title:"pH",value:d}))),s.a.createElement(J.a,{container:!0,spacing:4},s.a.createElement(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12},s.a.createElement(Q,{title:"Temperature",value:g}))),s.a.createElement(J.a,{container:!0,spacing:4},s.a.createElement(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12},s.a.createElement(Q,{title:"Salinity",value:j}))),s.a.createElement(J.a,{container:!0,spacing:4},s.a.createElement(J.a,{item:!0,xs:12,sm:12,md:12,lg:12,xl:12},s.a.createElement(Q,{title:"Disolved O2",value:k}))))},ae=Object(h.a)((function(){return s.a.createElement(g.a,null,s.a.createElement(N,null,s.a.createElement(v.d,null,s.a.createElement(v.b,{exact:!0,path:"/",component:W}),s.a.createElement(v.b,{exact:!0,path:"/sensor/:id",component:te}),s.a.createElement(v.a,{to:"/"}))))}),!1,[],null,null,{hideAllDefaults:!0,signUpFields:[{label:"Email",key:"username",required:!0,placeholder:"Email",type:"email",displayOrder:1},{label:"Password",key:"password",required:!0,placeholder:"Password",type:"password",displayOrder:2}]});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));u.b.configure(m),c.a.render(s.a.createElement(i.a,{theme:b},s.a.createElement(l.a,null),s.a.createElement(ae,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[730,1,2]]]);
//# sourceMappingURL=main.733df03d.chunk.js.map